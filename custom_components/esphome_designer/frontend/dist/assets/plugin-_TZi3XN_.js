const v=(e,p,t)=>{const a=p.width||400,d=p.height||300;e.style.width=a+"px",e.style.height=d+"px",e.style.position="relative",e.style.backgroundColor=t.background_color||"white",e.style.color=t.text_color||"black",e.style.padding="4px",e.style.boxSizing="border-box",t.show_border!==!1&&(e.style.border=`${t.border_width||2}px solid ${t.border_color||"black"}`);const i=new Date,f=i.getDate(),_=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],g=["January","February","March","April","May","June","July","August","September","October","November","December"],n=_[i.getDay()],b=`${g[i.getMonth()]} ${i.getFullYear()}`,r=document.createElement("div");r.style.textAlign="center",r.style.padding="2px",r.style.borderBottom="1px solid "+(t.text_color||"black"),r.style.flexShrink="0";const l=document.createElement("div");l.style.fontSize=Math.min((t.font_size_date||100)/2,80)+"px",l.style.fontWeight="100",l.style.lineHeight="0.8",l.innerText=f,r.appendChild(l);const u=document.createElement("div");u.style.fontSize=(t.font_size_day||24)+"px",u.style.fontWeight="bold",u.innerText=n,r.appendChild(u);const s=document.createElement("div");s.style.fontSize=(t.font_size_grid||14)+"px",s.innerText=b,r.appendChild(s),e.style.display="flex",e.style.flexDirection="column",e.appendChild(r);const c=document.createElement("div");c.style.display="grid",c.style.gridTemplateColumns="repeat(7, 1fr)",c.style.padding="2px",c.style.gap="1px",c.style.flexShrink="0";const w=(t.font_size_grid||14)+"px";["Mo","Tu","We","Th","Fr","Sa","Su"].forEach(h=>{const o=document.createElement("div");o.innerText=h,o.style.textAlign="center",o.style.fontWeight="bold",o.style.fontSize=w,c.appendChild(o)});const $=new Date(i.getFullYear(),i.getMonth(),1),x=new Date(i.getFullYear(),i.getMonth()+1,0).getDate();let m=$.getDay();m===0&&(m=7),m-=1;for(let h=0;h<m;h++)c.appendChild(document.createElement("div"));for(let h=1;h<=x;h++){const o=document.createElement("div");o.innerText=h,o.style.textAlign="center",o.style.fontSize=w,h===f&&(o.style.backgroundColor=t.text_color||"black",o.style.color=t.background_color||"white",o.style.borderRadius="50%",o.style.width="1.5em",o.style.height="1.5em",o.style.lineHeight="1.5em",o.style.margin="0 auto"),c.appendChild(o)}e.appendChild(c);const y=document.createElement("div");y.style.padding="5px",y.style.fontSize=(t.font_size_event||18)+"px",y.style.flexGrow="1",y.style.overflow="hidden",y.innerHTML=`
        <div style="margin-bottom:4px;"><b>${f}</b> Meeting with Team</div>
        <div><b>${Math.min(f+2,x)}</b> Dentist Appointment</div>
    `,e.appendChild(y)},D={id:"calendar",name:"Calendar",category:"Events",defaults:{entity_id:"sensor.esp_calendar_data",border_width:2,show_border:!0,border_color:"black",background_color:"white",text_color:"black",font_size_date:100,font_size_day:24,font_size_grid:14,font_size_event:18,width:335,height:340},render:(e,p)=>{const t=p.props||{};e.innerHTML="",v(e,p,t)},exportLVGL:(e,{common:p,convertColor:t,getLVGLFont:a})=>{const d=e.props||{},i=t(d.text_color||"black"),f=t(d.background_color||"white"),_=Math.min((d.font_size_date||100)/2,80),g=parseInt(d.font_size_day||24,10),n=parseInt(d.font_size_grid||14,10),b=d.font_family||"Roboto",r=_+g+n+10,l=[{label:{align:"TOP_MID",y:2,height:_+4,text:`!lambda "char buf[4]; id(ha_time).now().strftime(buf, sizeof(buf), '%d'); return buf;"`,text_font:a(b,_,100),text_color:i}},{label:{align:"TOP_MID",y:_+2,height:g+4,text:`!lambda "char buf[16]; id(ha_time).now().strftime(buf, sizeof(buf), '%A'); return buf;"`,text_font:a(b,g,700),text_color:i}},{label:{align:"TOP_MID",y:_+g+4,height:n+4,text:`!lambda "char buf[32]; id(ha_time).now().strftime(buf, sizeof(buf), '%B %Y'); return buf;"`,text_font:a(b,n,400),text_color:i}},{obj:{width:"100%",height:1,y:r,bg_color:i,border_width:0}}];return l.push({obj:{width:"100%",height:"SIZE_CONTENT",y:r+5,bg_opa:"TRANSP",border_width:0,layout:{type:"FLEX",flex_flow:"ROW_WRAP",flex_align_main:"SPACE_AROUND"},widgets:["Mo","Tu","We","Th","Fr","Sa","Su"].map(u=>({label:{text:`"${u}"`,text_font:a(b,n,700),text_color:i,width:"14%",align:"CENTER"}}))}}),l.push({label:{y:r+40,align:"TOP_MID",text:'"Calendar Grid Not Supported in LVGL Mode"',text_font:a("Roboto",12,400),text_color:"#888888"}}),{obj:{...p,bg_color:f,bg_opa:"COVER",radius:8,border_width:d.show_border!==!1?d.border_width||2:0,border_color:t(d.border_color||"black"),widgets:l}}},export:(e,p)=>{const{lines:t,addFont:a,getColorConst:d,addDitherMask:i,getCondProps:f,getConditionCheck:_,isEpaper:g}=p,n=e.props||{},b=(e.entity_id||n.entity_id||"sensor.esp_calendar_data").trim(),r=n.border_color||"black",l=n.text_color||"black",u=n.background_color||"white",s=d(l),c=d(r),w=d(u),$=n.show_border!==!1,C=parseInt(n.border_width||2,10),x=parseInt(n.font_size_date||100,10),m=parseInt(n.font_size_day||24,10),y=parseInt(n.font_size_grid||14,10),h=parseInt(n.font_size_event||18,10),o=n.font_family||"Roboto",M=a(o,100,Math.min(x/2,80)),z=a(o,700,m),T=a(o,400,y),S=a(o,400,h);t.push(`        // widget:calendar id:${e.id} type:calendar x:${e.x} y:${e.y} w:${e.width} h:${e.height} entity:${b} ${f(e)}`);const E=_(e);E&&t.push(`        ${E}`),t.push("        {"),t.push("          auto now = id(ha_time).now();"),t.push(`          int x = ${e.x}; int y = ${e.y}; int w = ${e.width}; int h = ${e.height};`),u!=="transparent"&&t.push(`          it.filled_rectangle(x, y, w, h, ${w});`),t.push("          // Header"),t.push(`          int headH = ${x/2+m+y+10};`),t.push(`          it.strftime(x + w/2, y + 2, id(${M}), ${s}, TextAlign::TOP_CENTER, "%d", now);`),t.push(`          it.strftime(x + w/2, y + ${x/2}, id(${z}), ${s}, TextAlign::TOP_CENTER, "%A", now);`),t.push(`          it.strftime(x + w/2, y + ${x/2+m}, id(${T}), ${s}, TextAlign::TOP_CENTER, "%B %Y", now);`),t.push(`          it.line(x, y + headH, x + w, y + headH, ${s});`),t.push("          // Days Grid"),t.push("          int gridY = y + headH + 5;"),t.push("          int cellW = w / 7;"),t.push('          const char* days[] = {"Mo", "Tu", "We", "Th", "Fr", "Sa", "Su"};'),t.push("          for(int i=0; i<7; i++) {"),t.push(`            it.print(x + i*cellW + cellW/2, gridY, id(${T}), ${s}, TextAlign::TOP_CENTER, days[i]);`),t.push("          }"),t.push("          // Simple logic to find start of month"),t.push("          time_t t = now.timestamp;"),t.push("          struct tm *tm = localtime(&t);"),t.push("          tm->tm_mday = 1;"),t.push("          mktime(tm);"),t.push("          int startDay = (tm->tm_wday + 6) % 7; // 0=Mon"),t.push("          int daysInMonth = 31; // Simplified"),t.push("          if(now.month == 2) daysInMonth = (now.year % 4 == 0) ? 29 : 28;"),t.push("          else if(now.month == 4 || now.month == 6 || now.month == 9 || now.month == 11) daysInMonth = 30;"),t.push("          int r = 1; int c = startDay;"),t.push(`          int rowH = ${y+4};`),t.push("          for(int d=1; d<=daysInMonth; d++) {"),t.push("            if(d == now.day_of_month) {"),t.push(`               it.filled_circle(x + c*cellW + cellW/2, gridY + r*rowH + 6, ${Math.floor(y/1.5)}, ${s});`),t.push(`               it.printf(x + c*cellW + cellW/2, gridY + r*rowH, id(${T}), ${w}, TextAlign::TOP_CENTER, "%d", d);`),t.push("            } else {"),t.push(`               it.printf(x + c*cellW + cellW/2, gridY + r*rowH, id(${T}), ${s}, TextAlign::TOP_CENTER, "%d", d);`),t.push("            }"),t.push("            c++; if(c>6) { c=0; r++; }"),t.push("          }"),t.push("          // Events (Mock or Sensor)"),t.push("          int eventY = gridY + (r+1)*rowH + 10;"),t.push(`          it.printf(x + 5, eventY, id(${S}), ${s}, TextAlign::TOP_LEFT, "<b>%d</b> Meeting with Team", now.day_of_month);`),t.push(`          it.printf(x + 5, eventY + ${h+4}, id(${S}), ${s}, TextAlign::TOP_LEFT, "<b>%d</b> Dentist Appointment", (now.day_of_month + 2) > daysInMonth ? 1 : now.day_of_month + 2);`),$&&(t.push(`          for (int i = 0; i < ${C}; i++) {`),t.push(`            it.rectangle(x + i, y + i, w - 2*i, h - 2*i, ${c});`),t.push("          }")),i(t,l,g,e.x,e.y,e.width,e.height),t.push("        }"),E&&t.push("        }")}};export{D as default};
