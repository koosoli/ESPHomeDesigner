const K=(n,y,{getColorStyle:_})=>{const s=y.props||{},f=y.entity_id||"",p=y.title||"",e=s.value_format||"label_value";let l=parseInt(s.precision,10);isNaN(l)&&(l=2);const t=s.unit||"",c=s.label_font_size||14,d=s.value_font_size||20,x=(s.font_family||"Roboto")+", sans-serif",$=String(s.font_weight||400),b=s.italic?"italic":"normal",L=_(s.color),N=y.entity_id_2||"",w=s.separator||" ~ ";let g="--";const m=e.endsWith("_no_unit");let h=s.hide_unit||m?"":t;const F=r=>{if(window.AppState&&window.AppState.entityStates&&r){const a=window.AppState.entityStates[r];if(a&&a.state!==void 0){const E=a.formatted||String(a.state);a.state;const V=E.match(/^([-+]?\d*[.,]?\d+)(.*)$/);if(V){const S=parseFloat(V[1].replace(",",".")),O=V[2]?V[2].trim():"";if(r===f&&(t===void 0||t==="")&&!s.hide_unit&&!m&&(h=O),!isNaN(S))return!isNaN(l)&&l>=0?S.toFixed(l):S.toString()}if(r===f&&(t===void 0||t==="")&&a.attributes&&a.attributes.unit_of_measurement&&!s.hide_unit&&!m&&(h=a.attributes.unit_of_measurement),m||s.hide_unit){const S=E.match(/^([-+]?\d*[.,]?\d+)/);if(S){const O=parseFloat(S[1].replace(",","."));if(!isNaN(O))return!isNaN(l)&&l>=0?O.toFixed(l):O.toString()}return E.replace(/\s*[°%]?[A-Za-z/²³]+\s*$/,"").trim()||E}return E}}return"--"},W=F(f);let C=null;N&&(C=F(N)),g=W,C!==null&&(g=`${W}${w}${C}`),h&&g.endsWith(h)&&(h="");let u=p;if(!u&&(e.startsWith("label_")||e==="value_label")&&window.AppState&&window.AppState.entityStates&&f){const r=window.AppState.entityStates[f];r&&r.attributes&&r.attributes.friendly_name?u=r.attributes.friendly_name:f&&(u=f.split(".").pop().replace(/_/g," "))}const P=s.prefix||"",A=s.postfix||"",v=`${P}${g}${h?" "+h:""}${A}`.trim();n.innerHTML="",n.style.display="flex";const T=(r,a)=>{r&&(r.includes("LEFT")?a.style.textAlign="left":r.includes("RIGHT")?a.style.textAlign="right":a.style.textAlign="center")};((r,a)=>{r.includes("LEFT")?a.style.justifyContent="flex-start":r.includes("RIGHT")?a.style.justifyContent="flex-end":a.style.justifyContent="center",r.includes("TOP")?a.style.alignItems="flex-start":r.includes("BOTTOM")?a.style.alignItems="flex-end":a.style.alignItems="center"})(s.text_align||"TOP_LEFT",n);const o=document.createElement("div");if(o.style.color=L,o.style.fontFamily=x,o.style.fontWeight=$,o.style.fontStyle=b,(e==="label_value"||e==="label_value_no_unit")&&u){o.style.display="flex",o.style.alignItems="baseline",o.style.gap="4px";const r=document.createElement("span");r.style.fontSize=`${c}px`,r.textContent=u+":";const a=document.createElement("span");a.style.fontSize=`${d}px`,a.textContent=v;const E=s.label_align||s.text_align||"TOP_LEFT";E.includes("CENTER")?o.style.justifyContent="center":E.includes("RIGHT")?o.style.justifyContent="flex-end":o.style.justifyContent="flex-start",o.appendChild(r),o.appendChild(a)}else if((e==="label_newline_value"||e==="label_newline_value_no_unit")&&u){o.style.display="flex",o.style.flexDirection="column",o.style.gap="2px",o.style.width="100%";const r=document.createElement("div");r.style.fontSize=`${c}px`,r.textContent=u,T(s.label_align||s.text_align||"TOP_LEFT",r);const a=document.createElement("div");a.style.fontSize=`${d}px`,a.textContent=v,T(s.value_align||s.text_align||"TOP_LEFT",a),o.appendChild(r),o.appendChild(a)}else if(e==="value_label"&&u){o.style.display="flex",o.style.alignItems="baseline",o.style.gap="4px";const r=document.createElement("span");r.style.fontSize=`${d}px`,r.textContent=v;const a=document.createElement("span");a.style.fontSize=`${c}px`,a.textContent=u,o.appendChild(r),o.appendChild(a)}else e==="label_only"?(o.style.fontSize=`${c}px`,o.textContent=u,T(s.text_align||"TOP_LEFT",o)):(o.style.fontSize=`${d}px`,o.textContent=v,T(s.value_align||s.text_align||"TOP_LEFT",o));n.appendChild(o)},Q={id:"sensor_text",name:"Sensor Text",category:"Sensors",defaults:{entity_id:"",title:"",value_format:"label_value",label_font_size:14,value_font_size:20,unit:"",precision:2,text_align:"TOP_LEFT",font_family:"Roboto"},render:K,exportLVGL:(n,{common:y,convertColor:_,convertAlign:s,getLVGLFont:f,formatOpacity:p})=>{const e=n.props||{};let l=(n.entity_id||"").trim();const t=(n.entity_id_2||"").trim(),c=e.value_format||"label_value";let d=parseInt(e.precision,10);(isNaN(d)||d<0)&&(d=1);const x=T=>{if(e.is_local_sensor)return`id(${T||"battery_level"})`;const R=T.replace(/[^a-zA-Z0-9_]/g,"_");return T.startsWith("text_sensor.")?`id(${R}_txt)`:`id(${R})`};if(!l&&!e.is_local_sensor)return null;const $=x(l),b=t?x(t):null,L=e.is_text_sensor||l&&(l.startsWith("text_sensor.")||l.startsWith("weather.")),N=t&&(e.is_text_sensor||t.startsWith("text_sensor.")||t.startsWith("weather."));let w=`!lambda |-
`;w+=`              if (${$}.has_state()${b?` && ${b}.has_state()`:""}) {
`;const g=e.unit||"",m=e.prefix||"",h=e.postfix||"",F=L?"%s":`%.${d}f`,W=b?N?"%s":`%.${d}f`:"",C=e.separator||" ~ ";let u=(n.title||e.title||"").trim();!u&&c.startsWith("label_")&&(u=l.split(".").pop().replace(/_/g," "));const P=L?`${$}.state.c_str()`:`${$}.state`,A=b?N?`${b}.state.c_str()`:`${b}.state`:null;let v="";return c==="label_only"?v=u:c==="label_value"||c==="label_value_no_unit"?v=`${u}: ${m}${F}${b?C+W:""}${g?" "+g:""}${h}`:c==="label_newline_value"||c==="label_newline_value_no_unit"?v=`${u}\\n${m}${F}${b?C+W:""}${g?" "+g:""}${h}`:c==="value_label"?v=`${m}${F}${b?C+W:""}${g?" "+g:""}${h} ${u}`:v=`${m}${F}${b?C+W:""}${g?" "+g:""}${h}`,w+=`                return str_sprintf("${v}", ${P}${A?`, ${A}`:""}).c_str();
`,w+=`              }
`,w+='              return "---";',{label:{...y,text:w,text_font:f(e.font_family,e.value_font_size||20,e.font_weight,e.italic),text_color:_(e.color),text_align:(s(e.text_align)||"LEFT").replace("TOP_","").replace("BOTTOM_",""),bg_color:e.bg_color&&e.bg_color!=="transparent"?_(e.bg_color):void 0,opa:p(e.opa)}}},collectRequirements:(n,{addFont:y})=>{const _=n.props||{},s=_.font_family||"Roboto",f=_.font_weight||400,p=!!_.italic;y(s,f,_.label_font_size||14,p),y(s,f,_.value_font_size||20,p)},export:(n,y)=>{const{lines:_,getColorConst:s,addFont:f,getCondProps:p,getConditionCheck:e,Utils:l}=y,t=n.props||{};let c=(n.entity_id||"").trim(),d=(n.entity_id_2||"").trim();c&&!t.is_local_sensor&&!c.includes(".")&&!c.startsWith("text_sensor.")&&(c=`sensor.${c}`),d&&!t.is_local_sensor&&!d.includes(".")&&!d.startsWith("text_sensor.")&&(d=`sensor.${d}`);const x=t.value_format||"label_value";let $=(t.unit||"").trim();if(!$&&!t.hide_unit&&!x.endsWith("_no_unit")&&window.AppState&&window.AppState.entityStates){const i=window.AppState.entityStates[c];if(i){if(i.attributes&&i.attributes.unit_of_measurement)$=i.attributes.unit_of_measurement;else if(i.formatted){const D=i.formatted.match(/^([-+]?\d*[.,]?\d+)\s*(.*)$/);D&&D[2]&&($=D[2].trim())}}}if(!$&&!t.hide_unit&&!x.endsWith("_no_unit")&&c){const i=c.toLowerCase();i.includes("_power")||i.includes("_watt")?$="W":i.includes("_energy")||i.includes("_kwh")?$="kWh":i.includes("_temperature")||i.includes("_temp")?$="°C":i.includes("_humidity")?$="%":i.includes("_voltage")||i.includes("_volt")?$="V":i.includes("_current")||i.includes("_amp")?$="A":i.includes("_battery")?$="%":i.includes("_pressure")||i.includes("_hpa")?$="hPa":i.includes("_speed")||i.includes("_kmh")?$="km/h":(i.includes("_percent")||i.includes("_pct"))&&($="%")}const b=t.label_font_size||14,L=t.value_font_size||20,N=t.font_family||"Roboto",w=t.font_weight||400,g=!!t.italic,m=s(t.color||(y.isDark?"white":"black")),h=t.text_align||"TOP_LEFT",F=t.separator||" ~ ",W=t.prefix||"",C=t.postfix||"";let u=parseInt(t.precision,10);if((isNaN(u)||u<0)&&(u=2),_.push(`        // widget:sensor_text id:${n.id} type:sensor_text x:${n.x} y:${n.y} w:${n.width} h:${n.height} ent:${c} fmt:${x} ${p(n)}`),!c&&!t.is_local_sensor){_.push("        // Sensor ID missing for this widget");return}const P=f(N,w,b,g),A=f(N,w,L,g),v=e(n);v&&_.push(`        ${v}`);const T=(i,D)=>{if(t.is_local_sensor)return`id(${i||"battery_level"})`;const Z=i.replace(/[^a-zA-Z0-9_]/g,"_");return t.is_text_sensor||i.startsWith("text_sensor.")?`id(${Z}_txt)`:`id(${Z})`},R=T(c),o=d?T(d):null,r=t.is_text_sensor||c&&(c.startsWith("text_sensor.")||c.startsWith("weather.")),a=d&&(t.is_text_sensor||d.startsWith("text_sensor.")||d.startsWith("weather.")),E=r?"%s":`%.${u}f`,V=a?"%s":`%.${u}f`;let S=(n.title||t.title||"").trim();!S&&x.startsWith("label_")&&(S=c.split(".").pop().replace(/_/g," "));const O=t.hide_unit||x.endsWith("_no_unit")?"":$,H=i=>i?i==="CENTER"?"TextAlign::CENTER":`TextAlign::${i}`:"TextAlign::TOP_LEFT",G=H(t.label_align||h),M=H(t.value_align||h);let z=n.x,I=n.y;const B=h.includes("CENTER"),q=h.includes("RIGHT");B?z=Math.round(n.x+n.width/2):q&&(z=Math.round(n.x+n.width)),h.includes("BOTTOM")?I=Math.round(n.y+n.height):h.includes("TOP")||(I=Math.round(n.y+n.height/2));const j=`${W}${E}${o?F+V:""}${O?" "+O:""}${C}`,U=r?`${R}.state.c_str()`:`${R}.state`,J=o?a?`${o}.state.c_str()`:`${o}.state`:null,k=o?`${U}, ${J}`:U;if(x==="label_only")_.push(`        it.printf(${z}, ${I}, id(${P}), ${m}, ${G}, "${S}");`);else if(x==="value_only"||x==="value_only_no_unit"||!S)_.push(`        it.printf(${z}, ${I}, id(${A}), ${m}, ${M}, "${j}", ${k});`);else if(x==="label_value"||x==="label_value_no_unit"){const i=`${S}${S.endsWith(":")?"":":"} `;_.push(`        it.printf(${z}, ${I}, id(${A}), ${m}, ${M}, "${i}${j}", ${k});`)}else if(x==="label_newline_value"||x==="label_newline_value_no_unit")_.push(`        it.printf(${z}, ${I}, id(${P}), ${m}, ${G}, "${S}");`),_.push(`        it.printf(${z}, ${I} + ${b+4}, id(${A}), ${m}, ${M}, "${j}", ${k});`);else if(x==="value_label"){_.push(`        it.printf(${z}, ${I}, id(${A}), ${m}, ${M}, "${j}", ${k});`);const i=Math.round(L*.6*6)+10;_.push(`        it.printf(${z} + ${i}, ${I}, id(${P}), ${m}, ${G}, "${S}");`)}v&&_.push("        }")},onExportTextSensors:n=>{const{lines:y,widgets:_}=n;if(!_)return;const s=new Set,f=new Set;for(const p of _){if(p.type!=="sensor_text")continue;const e=p.props||{},l=(p.entity_id||"").trim();l.startsWith("weather.")?s.add(l):(e.is_text_sensor||l.startsWith("text_sensor."))&&f.add(l);const t=(p.entity_id_2||e.entity_id_2||"").trim();t&&(t.startsWith("weather.")?s.add(t):(e.is_text_sensor||t.startsWith("text_sensor."))&&f.add(t))}if(s.size>0){y.push("# Weather Entity Sensors (Detected from Sensor Text)");for(const p of s){const e=p.replace(/^weather\./,"").replace(/\./g,"_").replace(/-/g,"_");y.push("- platform: homeassistant",`  id: ${e}`,`  entity_id: ${p}`,"  internal: true")}}if(f.size>0){y.push("# Text Sensors (Detected from Sensor Text)");for(const p of f){const e=p.replace(/[^a-zA-Z0-9_]/g,"_")+"_txt";y.push("- platform: homeassistant",`  id: ${e}`,`  entity_id: ${p}`,"  internal: true")}}},onExportNumericSensors:n=>{const{lines:y,widgets:_}=n;if(!_)return;const s=new Set;for(const f of _){if(f.type!=="sensor_text")continue;const p=f.props||{};if(p.is_local_sensor)continue;const e=[f.entity_id,f.entity_id_2].filter(l=>l&&l.trim());for(let l of e)if(l=l.trim(),!(p.is_text_sensor||l.startsWith("weather.")||l.startsWith("text_sensor."))&&(l.includes(".")||(l=`sensor.${l}`),!s.has(l))){s.add(l);const t=l.replace(/[^a-zA-Z0-9_]/g,"_");y.push("- platform: homeassistant",`  id: ${t}`,`  entity_id: ${l}`,"  internal: true")}}}};export{Q as default};
