const R=(e,t,s)=>{const o=t.props||{},{getColorStyle:h}=s,w=o.show_author!==!1,c=parseInt(o.quote_font_size||18,10),l=parseInt(o.author_font_size||14,10),i=o.font_family||"Roboto",d=parseInt(o.font_weight||400,10),q=o.color||"black",g=h(q),_=o.text_align||"TOP_LEFT",$=o.italic_quote!==!1,u=[{quote:"The only way to do great work is to love what you do.",author:"Steve Jobs"},{quote:"In the middle of difficulty lies opportunity.",author:"Albert Einstein"},{quote:"Life is what happens when you're busy making other plans.",author:"John Lennon"},{quote:"The future belongs to those who believe in the beauty of their dreams.",author:"Eleanor Roosevelt"},{quote:"Success is not final, failure is not fatal: it is the courage to continue that counts.",author:"Winston Churchill"},{quote:"Be yourself; everyone else is already taken.",author:"Oscar Wilde"},{quote:"Two things are infinite: the universe and human stupidity.",author:"Albert Einstein"},{quote:"Be the change that you wish to see in the world.",author:"Mahatma Gandhi"}],a=o.feed_url||"https://www.brainyquote.com/link/quotebr.rss",S=(a+(t.id||"default")).split("").reduce((n,v)=>(n<<5)-n+v.charCodeAt(0),0),T=u[Math.abs(S)%u.length],b=window.location.protocol==="file:"||typeof window.hasHaBackend!="function"||!window.hasHaBackend();window.quoteCache=window.quoteCache||{},window.quoteFetchTimers=window.quoteFetchTimers||{};const f=t.id+"|"+a,m=f+"_fetching",C=t.id+"_lastUrl";if(window.quoteCache[C]!==a&&(window.quoteCache[C]=a,window.quoteFetchTimers[t.id]&&(clearTimeout(window.quoteFetchTimers[t.id]),window.quoteFetchTimers[t.id]=null)),!window.quoteCache[f]&&!window.quoteCache[m]){window.quoteCache[m]=!0;const n=a,v=f,z=m;window.quoteFetchTimers[t.id]=setTimeout(async()=>{try{let y;b?y=null:y=await(await fetch(`/api/esphome_designer/rss_proxy?url=${encodeURIComponent(n)}`)).json(),y&&y.success&&y.quote&&(window.quoteCache[v]=y.quote,window.emit&&window.EVENTS&&window.emit(window.EVENTS.STATE_CHANGED))}catch{}finally{window.quoteCache[z]=!1,window.quoteFetchTimers[t.id]=null}},500)}const x=window.quoteCache[f]||T,E=!!window.quoteCache[f];e.style.display="flex",e.style.flexDirection="column",e.style.boxSizing="border-box",e.style.padding="8px",e.style.overflow="hidden",e.style.fontFamily=i+", serif",e.style.fontWeight=String(d),e.style.color=g,e.style.lineHeight="1.3",_.includes("CENTER")?(e.style.textAlign="center",e.style.alignItems="center"):_.includes("RIGHT")?(e.style.textAlign="right",e.style.alignItems="flex-end"):(e.style.textAlign="left",e.style.alignItems="flex-start"),_.startsWith("CENTER")?e.style.justifyContent="center":_.startsWith("BOTTOM")?e.style.justifyContent="flex-end":e.style.justifyContent="flex-start",e.innerHTML="";const F=o.word_wrap!==!1,r=document.createElement("div");if(r.style.fontSize=c+"px",r.style.fontStyle=$?"italic":"normal",r.style.marginBottom="8px",F?(r.style.wordWrap="break-word",r.style.overflowWrap="break-word",r.style.whiteSpace="normal"):(r.style.whiteSpace="nowrap",r.style.overflow="hidden",r.style.textOverflow="ellipsis"),r.textContent='"'+x.quote+'"',e.appendChild(r),w){const n=document.createElement("div");n.style.fontSize=l+"px",n.style.fontStyle="normal",n.style.opacity="0.8",n.textContent="â€” "+x.author,e.appendChild(n)}const p=document.createElement("div");p.style.fontSize="9px",p.style.opacity="0.5",p.style.marginTop="auto",p.style.paddingTop="4px";try{const n=new URL(a);b?p.textContent="ðŸ”Œ OFFLINE - "+n.hostname:E?p.textContent="ðŸŸ¢ "+n.hostname:p.textContent="âšª "+n.hostname}catch{p.textContent=b?"ðŸ”Œ OFFLINE":"ðŸ“° RSS Feed"}e.appendChild(p)},A=(e,t)=>{const{lines:s,addFont:o,getColorConst:h,getCondProps:w,getConditionCheck:c,getAlignX:l}=t,i=e.props||{},d=parseInt(i.quote_font_size||18,10),q=parseInt(i.author_font_size||14,10),g=i.font_family||"Roboto",_=parseInt(i.font_weight||400,10),$=i.color||"black",u=h($),a=i.text_align||"TOP_LEFT",I=i.italic_quote!==!1,S=i.word_wrap!==!1,T=`quote_${e.id.replace(/-/g,"_")}`,b=`${T}_text_global`,f=`${T}_author_global`,m=o(g,_,d,I),C=o(g,_,q,!1);s.push(`        // widget:quote_rss id:${e.id} type:quote_rss x:${e.x} y:${e.y} w:${e.width} h:${e.height} color:${$} align:${a} ${w(e)}`);const x=c(e);if(x&&s.push(`        ${x}`),s.push("        {"),s.push(`          std::string q_text = id(${b});`),i.show_author!==!1&&s.push(`          std::string q_author = id(${f});`),S)s.push(`          int max_w = ${e.width-16};`),s.push(`          int q_h = ${d+4};`),s.push('          std::string display_text = "\\"" + q_text + "\\"";'),s.push("          auto print_q = [&](esphome::font::Font *f, int line_h, bool draw) -> int {"),s.push(`            int y_curr = ${e.y+8};`),s.push('            std::string curr_line = "";'),s.push("            size_t pos = 0; size_t space_pos;"),s.push("            while ((space_pos = display_text.find(' ', pos)) != std::string::npos) {"),s.push("                std::string word = display_text.substr(pos, space_pos - pos);"),s.push('                std::string test_line = curr_line.empty() ? word : curr_line + " " + word;'),s.push("                int w_m, h_m, xoff_m, bl_m;"),s.push("                f->measure(test_line.c_str(), &w_m, &xoff_m, &bl_m, &h_m);"),s.push("                if (w_m > max_w && !curr_line.empty()) {"),s.push(`                    if (draw) it.printf(${e.x+8}, y_curr, f, ${u}, "%s", curr_line.c_str());`),s.push("                    y_curr += line_h;"),s.push("                    curr_line = word;"),s.push("                } else { curr_line = test_line; }"),s.push("                pos = space_pos + 1;"),s.push("            }"),s.push("            if (!curr_line.empty()) {"),s.push("                std::string rem = display_text.substr(pos);"),s.push('                if (!curr_line.empty()) curr_line += " "; curr_line += rem;'),s.push("            }"),s.push("            if (!curr_line.empty()) {"),s.push(`                if (draw) it.printf(${e.x+8}, y_curr, f, ${u}, "%s", curr_line.c_str());`),s.push("                y_curr += line_h;"),s.push("            }"),s.push(`            return y_curr - ${e.y+8};`),s.push("          };"),s.push(`          print_q(id(${m}), q_h, true);`),i.show_author!==!1&&s.push(`          if (!q_author.empty()) it.printf(${e.x+8}, ${e.y} + ${e.height} - ${q+4}, id(${C}), ${u}, "â€” %s", q_author.c_str());`);else{const E=l(a,e.x,e.width),F=`TextAlign::${a}`;s.push(`          it.printf(${E}, ${e.y}, id(${m}), ${u}, ${F}, "\\"%s\\"", q_text.c_str());`),i.show_author!==!1&&s.push(`          if (!q_author.empty()) it.printf(${E}, ${e.y+d+4}, id(${C}), ${u}, ${F}, "â€” %s", q_author.c_str());`)}s.push("        }"),x&&s.push("        }")},O=e=>{const{lines:t,widgets:s}=e;s.filter(o=>o.type==="quote_rss").forEach(o=>{const h=`quote_${o.id.replace(/-/g,"_")}`;t.push(`- id: ${h}_text_global`),t.push("  type: std::string"),t.push("  restore_value: true"),t.push(`  initial_value: '""'`),o.props&&o.props.show_author!==!1&&(t.push(`- id: ${h}_author_global`),t.push("  type: std::string"),t.push("  restore_value: true"),t.push(`  initial_value: '""'`))})},W=e=>{const{lines:t,widgets:s,displayId:o}=e,h=s.filter(w=>w.type==="quote_rss");if(h.length>0){t.some(c=>c.trim().startsWith("http_request:"))||(t.push(""),t.push("http_request:"),t.push("  verify_ssl: false"),t.push("  timeout: 20s")),t.push(""),t.push("# Quote RSS Widget Update Loop"),t.push("interval:");for(const c of h){const l=c.props||{},i=l.refresh_interval||"1h",d=`quote_${c.id.replace(/-/g,"_")}`,q=l.feed_url||"https://www.brainyquote.com/link/quotebr.rss",g=l.random!==!1,u=`${(l.ha_url||"http://homeassistant.local:8123").replace(/\/$/,"")}/api/esphome_designer/rss_proxy?url=${encodeURIComponent(q)}${g?"&random=true":""}`;t.push(`  - interval: ${i}`),t.push("    startup_delay: 20s"),t.push("    then:"),t.push("      - if:"),t.push("          condition:"),t.push("            wifi.connected:"),t.push("          then:"),t.push("            - http_request.get:"),t.push(`                url: "${u}"`),t.push("                capture_response: true"),t.push("                on_response:"),t.push("                  - lambda: |-"),t.push("                      if (response->status_code == 200) {"),t.push("                        DynamicJsonDocument doc(4096);"),t.push("                        DeserializationError error = deserializeJson(doc, body);"),t.push("                        if (error) {"),t.push('                          ESP_LOGW("quote", "Failed to parse JSON: %s", error.c_str());'),t.push("                          return;"),t.push("                        }"),t.push('                        if (doc.containsKey("success") && doc["success"].as<bool>()) {'),t.push('                          JsonObject q = doc["quote"];'),t.push("                          if (!q.isNull()) {"),t.push('                            std::string q_str = q["quote"].as<std::string>();'),t.push(`                            id(${d}_text_global) = q_str;`),l.show_author!==!1&&t.push(`                            id(${d}_author_global) = q["author"].as<std::string>();`),t.push('                            ESP_LOGI("quote", "Fetched quote: %s", q_str.c_str());'),t.push(`                            id(${o}).update();`),t.push("                          }"),t.push("                        }"),t.push("                      } else {"),t.push('                        ESP_LOGW("quote", "HTTP Request failed with code: %d", response->status_code);'),t.push("                      }")}t.push("")}},P=e=>{const{lines:t,widgets:s}=e,o=s.filter(h=>h.type==="quote_rss");if(o.length===0)return;t.push("# Quote RSS Widget Text Sensors (visible in Home Assistant)");for(const h of o){const w=`quote_${h.id.replace(/-/g,"_")}`,c=h.props||{};t.push("- platform: template"),t.push(`  id: ${w}_text_sensor`),t.push('  name: "Quote Text"'),t.push('  icon: "mdi:format-quote-close"'),t.push(`  lambda: 'return id(${w}_text_global);'`),t.push("  update_interval: 60s"),c.show_author!==!1&&(t.push("- platform: template"),t.push(`  id: ${w}_author_sensor`),t.push('  name: "Quote Author"'),t.push('  icon: "mdi:account"'),t.push(`  lambda: 'return id(${w}_author_global);'`),t.push("  update_interval: 60s"))}},L={id:"quote_rss",name:"Quote RSS",category:"Events",defaults:{feed_url:"https://www.brainyquote.com/link/quotebr.rss",quote_font_size:18,author_font_size:14,font_family:"Roboto",font_weight:400,color:"black",text_align:"TOP_LEFT",show_author:!0,italic_quote:!0,word_wrap:!0,width:400,height:120,refresh_interval:"1h",ha_url:"http://homeassistant.local:8123",random:!0},render:R,onExportGlobals:O,onExportComponents:W,onExportTextSensors:P,export:A};export{L as default};
